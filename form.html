<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Formulário de Anamnese Psicanalítica</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      background-color: #fff;
      color: #333;
    }
    input, textarea, select {
      border: 1px solid #ccc;
      border-radius: 0.25rem;
      padding: 0.35rem 0.5rem;
      width: 100%;
      font-size: 1rem;
      line-height: 1.2;
      box-sizing: border-box;
    }
    input[type="checkbox"] {
      width: auto;
      margin-right: 4px;
      vertical-align: middle;
    }
    textarea {
      resize: vertical;
      min-height: 2.5rem;
    }
    .form-row {
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
    }
    .input-group {
      display: inline-flex;
      align-items: center;
      margin-right: 1rem;
    }
    .input-group:last-child {
      margin-right: 0;
    }
    .checkbox-group {
      display: inline-flex;
      align-items: center;
      margin-right: 1rem;
    }
    .inline-input {
      display: inline-block;
    }
    .section-title {
      font-weight: 700;
      font-size: 1.12rem;
      margin-bottom: 0.75rem;
      margin-top: 1.75rem;
      padding-bottom: 0.35rem;
      border-bottom: 1px solid #e5e7eb;
      color: #2563eb;
    }
    .sub-title {
      font-weight: 600;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
    }
    .field-label {
      font-weight: 500;
      margin-bottom: 0.15rem;
      display: inline-block;
      min-width: fit-content;
    }
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e5e7eb;
    }
    .logo {
      max-height: 100px;
      width: auto;
      background-color: transparent;
    }
    .fixed-width-xs {
      width: 3rem !important;
    }
    .fixed-width-sm {
      width: 5rem !important;
    }
    .fixed-width-md {
      width: 7rem !important;
    }
    .fixed-width-lg {
      width: 10rem !important;
    }
    .fixed-width-xl {
      width: 15rem !important;
    }
    @media print {
      body {
        background: #fff !important;
      }
      input, textarea, select {
        border: 1px solid #aaa !important;
        background: #fff !important;
        color: #000 !important;
      }
      .section-title {
        color: #000 !important;
      }
    }
    .btn {
      display: inline-block;
      font-weight: 500;
      text-align: center;
      vertical-align: middle;
      cursor: pointer;
      user-select: none;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      line-height: 1.5;
      border-radius: 0.25rem;
      transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    .btn-primary {
      color: #fff;
      background-color: #2563eb;
      border-color: #2563eb;
    }
    .btn-primary:hover {
      background-color: #1d4ed8;
      border-color: #1e40af;
    }
    .btn-success {
      color: #fff;
      background-color: #10b981;
      border-color: #10b981;
    }
    .btn-success:hover {
      background-color: #059669;
      border-color: #047857;
    }
    .message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .message-success {
      background-color: #d1fae5;
      color: #065f46;
      border: 1px solid #a7f3d0;
    }
    .message-error {
      background-color: #fee2e2;
      color: #b91c1c;
      border: 1px solid #fecaca;
    }
    .hidden {
      display: none;
    }
    .actions-bar {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
      padding: 15px 0;
      border-top: 1px solid #e5e7eb;
    }
  </style>
</head>
<body class="mx-auto px-4 py-6 max-w-4xl">
  <div class="header-container">
    <h1 class="text-2xl font-bold">Anamnese Psicanalítica</h1>
    <img src="image/logo_bg.png" alt="Logo" class="logo">
  </div>
  
  <!-- FORMULÁRIO 1 -->
  <form>
    <!-- Dados Pessoais -->
    <div class="section-title">Dados Pessoais</div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div class="mb-2">
        <label class="field-label">Nome:</label>
        <input type="text" name="nome">
      </div>
      <div class="mb-2 form-row">
        <div class="input-group">
          <label class="field-label">Data nasc.:</label>
          <input type="text" name="data_nasc" placeholder="__/__/__" class="fixed-width-md ml-1">
        </div>
        <div class="input-group">
          <label class="field-label ml-3">Idade:</label>
          <input type="text" name="idade" class="fixed-width-xs ml-1">
        </div>
      </div>
      <div class="mb-2 form-row">
        <div class="input-group">
          <label class="field-label">Sexo:</label>
          <input type="text" name="sexo" class="fixed-width-sm ml-1">
        </div>
        <div class="input-group">
          <label class="field-label ml-3">Estado Civil:</label>
          <input type="text" name="estado_civil" class="fixed-width-lg ml-1">
        </div>
      </div>
      <div class="mb-2">
        <label class="field-label">Orient. Sexual:</label>
        <input type="text" name="orient_sexual">
      </div>
      <div class="mb-2">
        <label class="field-label">Religião:</label>
        <input type="text" name="religiao">
      </div>
      <div class="mb-2 form-row">
        <div class="input-group">
          <label class="field-label">Cidade:</label>
          <input type="text" name="cidade" class="fixed-width-lg ml-1">
        </div>
        <div class="input-group">
          <label class="field-label ml-3">Estado:</label>
          <input type="text" name="estado" class="fixed-width-xs ml-1">
        </div>
      </div>
      <div class="mb-2">
        <label class="field-label">Tel:</label>
        <input type="text" name="tel">
      </div>
      <div class="mb-2">
        <label class="field-label">E-mail:</label>
        <input type="text" name="email">
      </div>
      <div class="mb-2">
        <label class="field-label">Escolaridade:</label>
        <input type="text" name="escolaridade">
      </div>
      <div class="mb-2">
        <label class="field-label">Profissão:</label>
        <input type="text" name="profissao">
      </div>
      <div class="mb-2">
        <label class="field-label">Empresa:</label>
        <input type="text" name="empresa">
      </div>
    </div>
    <!-- Fim Dados Pessoais -->

    <!-- Família e Relacionamentos -->
    <div class="section-title">Família e Relacionamentos</div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div class="mb-2 form-row">
        <div class="input-group">
          <label class="field-label">Cônjuge:</label>
          <input type="text" name="conjuge" class="fixed-width-lg ml-1">
        </div>
        <div class="input-group">
          <label class="field-label ml-3">Idade:</label>
          <input type="text" name="conjuge_idade" class="fixed-width-xs ml-1">
        </div>
      </div>
      <div class="mb-2">
        <label class="field-label">Profissão (cônjuge):</label>
        <input type="text" name="conjuge_profissao">
      </div>
      <div class="mb-2">
        <label class="field-label">Filhos (nome, idade):</label>
        <input type="text" name="filhos">
      </div>
      <div class="mb-2">
        <label class="field-label">Pai:</label>
        <input type="text" name="pai">
      </div>
      <div class="mb-2">
        <label class="field-label">Mãe:</label>
        <input type="text" name="mae">
      </div>
      <div class="mb-2 form-row">
        <div class="input-group">
          <label class="field-label">Número de irmãos:</label>
          <input type="text" name="num_irmaos" class="fixed-width-xs ml-1">
        </div>
        <div class="input-group">
          <label class="field-label ml-3">Relação com irmãos:</label>
          <input type="text" name="relacao_irmaos" class="fixed-width-xl ml-1">
        </div>
      </div>
    </div>
    <!-- Fim Família e Relacionamentos -->

    <!-- Queixas e Terapia Anterior -->
    <div class="section-title">Queixas e Terapia Anterior</div>
    <div class="mb-3">
      <label class="field-label">Principais queixas:</label>
      <textarea rows="2" name="principais_queixas"></textarea>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-2">
      <div class="form-row">
        <span class="field-label">Fez terapia antes?</span>
        <div class="checkbox-group ml-2">
          <input type="checkbox" id="terapia_sim" name="terapia_sim">
          <label for="terapia_sim" class="ml-1">Sim</label>
        </div>
        <div class="checkbox-group ml-2">
          <input type="checkbox" id="terapia_nao" name="terapia_nao">
          <label for="terapia_nao" class="ml-1">Não</label>
        </div>
        <div class="input-group ml-3">
          <label>Quando?</label>
          <input type="text" name="terapia_quando" class="fixed-width-md ml-1">
        </div>
      </div>
      <div class="form-row">
        <div class="input-group">
          <label class="field-label">Por quanto tempo?</label>
          <input type="text" name="tempo_terapia" class="fixed-width-md ml-1">
        </div>
        <div class="input-group">
          <label class="field-label ml-3">Motivo interrupção:</label>
          <input type="text" name="motivo_interrupcao" class="fixed-width-lg ml-1">
        </div>
      </div>
    </div>
    <!-- Fim Queixas e Terapia Anterior -->

    <!-- Histórico Clínico -->
    <div class="section-title">Histórico Clínico</div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div class="mb-2">
        <label class="field-label">Doenças físicas:</label>
        <input type="text" name="doencas_fisicas">
      </div>
      <div class="mb-2">
        <label class="field-label">Transt. psiquiátricos (pessoais):</label>
        <input type="text" name="transtorno_pessoal">
      </div>
      <div class="mb-2">
        <label class="field-label">Transt. psiquiátricos (familiares):</label>
        <input type="text" name="transtorno_familiar">
      </div>
      <div class="mb-2">
        <label class="field-label">Doenças importantes:</label>
        <input type="text" name="doencas_importantes">
      </div>
      <div class="md:col-span-2 mb-2">
        <label class="field-label">Medicação atual:</label>
        <input type="text" name="medicacao_atual">
      </div>
    </div>
    <!-- Fim Histórico Clínico -->
  </form>


  <!-- FORMULÁRIO 2 -->
  <form class="mt-10">
    <div class="section-title">Continuação do Histórico Clínico</div>
    <div class="mb-3">
      <label class="field-label">Doenças importantes:</label>
      <input type="text" name="doencas_importantes_2">
    </div>
    <div class="mb-3">
      <label class="field-label">Medicação atual:</label>
      <input type="text" name="medicacao_atual_2">
    </div>
    
    <!-- Hábitos e Eventos Significativos -->
    <div class="section-title">Hábitos e Eventos Significativos</div>
    <div class="mb-3">
      <label class="field-label">Fatores de estresse atuais:</label>
      <input type="text" name="fatores_estresse_atuais">
    </div>
    <div class="mb-3">
      <label class="field-label">Eventos traumáticos:</label>
      <input type="text" name="eventos_traumaticos">
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-2">
      <div class="mb-2 form-row">
        <label class="field-label">Uso de drogas?</label>
        <div class="checkbox-group ml-2">
          <input type="checkbox" id="drogas_sim" name="drogas_sim">
          <label for="drogas_sim" class="ml-1">Sim</label>
        </div>
        <div class="checkbox-group ml-2">
          <input type="checkbox" id="drogas_nao" name="drogas_nao">
          <label for="drogas_nao" class="ml-1">Não</label>
        </div>
        <div class="input-group ml-3">
          <label>Quais/Freq.?</label>
          <input type="text" name="drogas_quais_freq" class="fixed-width-md ml-1">
        </div>
      </div>
      <div class="mb-2 form-row">
        <label class="field-label">Uso de álcool?</label>
        <div class="checkbox-group ml-2">
          <input type="checkbox" id="alcool_sim" name="alcool_sim">
          <label for="alcool_sim" class="ml-1">Sim</label>
        </div>
        <div class="checkbox-group ml-2">
          <input type="checkbox" id="alcool_nao" name="alcool_nao">
          <label for="alcool_nao" class="ml-1">Não</label>
        </div>
        <div class="input-group ml-3">
          <label>Quant./Freq.?</label>
          <input type="text" name="alcool_quant_freq" class="fixed-width-md ml-1">
        </div>
      </div>
      <div class="mb-2 form-row">
        <label class="field-label">Tabagismo?</label>
        <div class="checkbox-group ml-2">
          <input type="checkbox" id="tabagismo_sim" name="tabagismo_sim">
          <label for="tabagismo_sim" class="ml-1">Sim</label>
        </div>
        <div class="checkbox-group ml-2">
          <input type="checkbox" id="tabagismo_nao" name="tabagismo_nao">
          <label for="tabagismo_nao" class="ml-1">Não</label>
        </div>
        <div class="input-group ml-3">
          <label>Quant. diária:</label>
          <input type="text" name="tabagismo_quant" class="fixed-width-md ml-1">
        </div>
      </div>
      <div class="mb-2 form-row">
        <div class="input-group">
          <label class="field-label">Hábitos de sono:</label>
          <input type="text" name="habitos_sono" class="fixed-width-md ml-1">
        </div>
        <div class="input-group">
          <label class="field-label ml-3">Atividade física:</label>
          <input type="text" name="atividade_fisica" class="fixed-width-md ml-1">
        </div>
      </div>
    </div>
    <div class="mb-3">
      <label class="field-label">Gatilhos emocionais:</label>
      <input type="text" name="gatilhos_emocionais">
    </div>
    <div class="mb-3 form-row">
      <label class="field-label">Tentativa de suicídio?</label>
      <div class="checkbox-group ml-2">
        <input type="checkbox" id="suicidio_sim" name="suicidio_sim">
        <label for="suicidio_sim" class="ml-1">Sim</label>
      </div>
      <div class="checkbox-group ml-2">
        <input type="checkbox" id="suicidio_nao" name="suicidio_nao">
        <label for="suicidio_nao" class="ml-1">Não</label>
      </div>
      <div class="input-group ml-3">
        <label>Quando?</label>
        <input type="text" name="suicidio_quando" class="fixed-width-md ml-1">
      </div>
    </div>

    <!-- Observações Gerais -->
    <div class="section-title">Observações Gerais</div>
    <textarea rows="5" name="observacoes_gerais" class="mb-3"></textarea>
  </form>

  <!-- Barra de Ações -->
  <div class="actions-bar">
    <!-- Mensagens de sucesso/erro -->
    <div id="message-container" class="hidden message mr-auto"></div>
    
    <button type="button" id="btn-gerar-pdf" class="btn btn-primary">Gerar PDF</button>
    <a id="download-link" href="#" class="btn btn-success ml-3 hidden">Baixar PDF</a>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const formElements = document.querySelectorAll('form');
      const btnGerarPdf = document.getElementById('btn-gerar-pdf');
      const downloadLink = document.getElementById('download-link');
      const messageContainer = document.getElementById('message-container');
      
      btnGerarPdf.addEventListener('click', function() {
        // Coletar dados de todos os formulários
        const formData = {};
        
        // Processa todos os formulários
        formElements.forEach(form => {
          // Percorre todos os inputs, selects e textareas
          Array.from(form.elements).forEach(element => {
            if (element.name) {
              if (element.type === 'checkbox') {
                formData[element.name] = element.checked;
              } else {
                formData[element.name] = element.value;
              }
            }
          });
        });
        
        // Adiciona timestamp de geração
        formData.data_geracao = new Date().toLocaleString('pt-BR');
        
        // Envia os dados para o servidor
        fetch('/gerar-pdf', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Mostra mensagem de sucesso
            messageContainer.textContent = data.message;
            messageContainer.className = 'message message-success';
            messageContainer.classList.remove('hidden');
            
            // Configura link para download
            downloadLink.href = `/pdfs/${data.filename}`;
            downloadLink.classList.remove('hidden');
          } else {
            // Mostra mensagem de erro
            messageContainer.textContent = data.message;
            messageContainer.className = 'message message-error';
            downloadLink.classList.add('hidden');
          }
        })
        .catch(error => {
          console.error('Erro:', error);
          messageContainer.textContent = 'Erro ao gerar PDF. Por favor, tente novamente.';
          messageContainer.className = 'message message-error';
          downloadLink.classList.add('hidden');
        });
      });
    });
  </script>
</body>
</html>
